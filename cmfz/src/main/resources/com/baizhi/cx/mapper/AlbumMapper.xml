<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.baizhi.cx.mapper.AlbumMapper">
    <resultMap id="alb" type="com.baizhi.cx.entity.Album">
        <id column="id" property="id"/>
        <result column="title" property="title"/>
        <result column="count" property="count"/>
        <result column="coverimg" property="coverimg"/>
        <result column="score" property="score"/>
        <result column="author" property="author"/>
        <result column="broadcast" property="broadcast"/>
        <result column="brief" property="brief"/>
        <result column="pubdate" property="pubdate"/>
        <collection property="children" ofType="com.baizhi.cx.entity.Chapter">
            <id column="cid" property="id"/>
            <result column="ctitle" property="title"/>
            <result column="csize" property="size"/>
            <result column="cduration" property="duration"/>
            <result column="chpath" property="chpath"/>
            <result column="cuploaddate" property="uploaddate"/>
            <result column="albumid" property="albumid"/>
        </collection>
    </resultMap>
    <select id="queryById" parameterType="String" resultType="com.baizhi.cx.entity.Album">
select * from album where id=#{id}
    </select>
    <select id="queryAllcx" resultMap="alb">
SELECT
	a.id id, a.title title, a.count count, a.coverimg coverimg ,a.score score, a.author author,a.broadcast broadcast,a.brief brief,a.pubdate pubdate,
c.id cid ,c.title ctitle, c.size csize ,c.duration cduration,c.chpath chpath, c.uploaddate cuploaddate ,c.albumid albumid
FROM
	album a
LEFT OUTER JOIN chapter c ON a.id = c.albumid limit ${(page-1)*row},#{row}

    </select>
    <insert id="addAlbum" parameterType="com.baizhi.cx.entity.Album">
insert into album(id,title,count,coverimg,score,author,broadcast,brief,pubdate)
values(#{id},#{title},0,#{coverimg},#{score},#{author},#{broadcast},#{brief},NOW())
    </insert>
<update id="updatealbum" parameterType="String">
UPDATE album set COUNT=COUNT+1  where id=#{id}
</update>
</mapper>
